# MultimediaOS-MUGEN Docker Setup

This document describes how to set up and run the MultimediaOS-MUGEN environment using Docker Compose.

## Overview

The Mugen environment consists of three main services:

1. **cc-api** - Claude Code API server
2. **browser-api** - Browser automation API with VNC/noVNC access
3. **discord-bot** - Discord bot for integration

## Prerequisites

1. Docker and Docker Compose installed
2. Environment variables configured (see `.env.example`)
3. API keys for:
   - Z.AI (for GLM models) OR Anthropic (for Claude models)
   - Google API (for agentic-vision-gemini skill)
   - FAL API (for fal-ai skill)
   - GitHub Personal Access Token (for Git operations)
   - Discord Bot Token

## Setup Instructions

### 1. Configure Environment Variables

Copy `.env.example` to `.env` and fill in your values:

```bash
cp .env.example .env
```

Required configurations:
- `ZAI_API_KEY` - Your Z.AI API key
- `GIT_USER_NAME_AYANO` - Git username for AYANO agent
- `GIT_USER_EMAIL_AYANO` - Git email for AYANO agent
- `GH_PAT_AYANO` - GitHub Personal Access Token for AYANO
- `DISCORD_TOKEN` - Discord bot token

### 2. Create Directory Structure

Create the following directories if they don't exist:

```bash
mkdir -p config/agent2/MultimediaOS-MUGEN/media
mkdir -p data/screenshots
mkdir -p data/chrome-profile
mkdir -p data/.claude
```

### 3. Build and Start Services

```bash
# Build images (first time only)
docker-compose -f docker-compose-mugen.yml build

# Start all services
docker-compose -f docker-compose-mugen.yml up -d

# View logs
docker-compose -f docker-compose-mugen.yml logs -f
```

## Service URLs

Once started, the services will be available at:

- **CC API**: http://localhost:8081 (or $CC_API_PORT)
- **Browser API**: http://localhost:8083 (or $BROWSER_API_PORT)
- **Browser VNC**: localhost:5900 (or $BROWSER_VNC_PORT)
- **Browser noVNC**: http://localhost:7900 (or $BROWSER_NOVNC_PORT)
- **Discord Bot**: http://localhost:8082 (or $DISCORD_BOT_PORT)

## Project Workspace

The cc-api service mounts the `./config/agent2/MultimediaOS-MUGEN` directory to `/workspace`, making it available within the container for your project work.

## Media Storage

Media files generated by the system will be stored in:
- Host: `./config/agent2/MultimediaOS-MUGEN/media`
- Container: `/workspace/media`

## Stopping Services

```bash
# Stop all services
docker-compose -f docker-compose-mugen.yml down

# Stop and remove containers
docker-compose -f docker-compose-mugen.yml down -v
```

## Troubleshooting

### Health Check Failures

The cc-api service has a health check that verifies the server is running. If it fails:

1. Check the logs: `docker-compose -f docker-compose-mugen.yml logs cc-api`
2. Verify environment variables are correctly set
3. Ensure the API key is valid

### Volume Mount Issues

If you encounter permission issues with volume mounts:

1. Ensure the directories exist on the host
2. Check Docker's permissions for the mounted directories
3. The cinderella user in the container should have write access

### Network Issues

All services are on the `cinderella-network` Docker network. Services can communicate using their service names (e.g., `http://cc-api:8080`).

## Environment Variables Reference

| Variable | Default | Description |
|----------|---------|-------------|
| `CC_API_PORT` | 8081 | CC API port |
| `BROWSER_API_PORT` | 8083 | Browser API port |
| `BROWSER_VNC_PORT` | 5900 | VNC port |
| `BROWSER_NOVNC_PORT` | 7900 | noVNC port |
| `DISCORD_BOT_PORT` | 8082 | Discord Bot port |
| `ZAI_API_KEY` | - | Z.AI API key (required) |
| `GOOGLE_API_KEY` | - | Google API key (optional) |
| `FAL_KEY` | - | FAL API key (optional) |
| `GH_PAT_AYANO` | - | GitHub PAT for AYANO (required) |
| `GIT_USER_NAME_AYANO` | - | Git username for AYANO (required) |
| `GIT_USER_EMAIL_AYANO` | - | Git email for AYANO (required) |
| `DISCORD_TOKEN` | - | Discord bot token (required) |
| `CLAUDE_SKIP_PERMISSIONS` | - | Skip permission prompts (0 or 1) |

## Security Notes

- Never commit your `.env` file with real API keys
- Use separate GitHub PATs for different environments if needed
- The cinderella user has sudo privileges without password in the container
- Consider using Docker secrets for sensitive data in production