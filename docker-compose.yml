services:
  cc-api:
    build:
      context: ./cc-api
    ports:
      - "8081:8080"
    volumes:
      # Claude Code 設定ディレクトリ（cinderellaユーザー用）
      - ./data/.claude:/home/cinderella/.claude
      # プロジェクトディレクトリをマウント
      - ./config/bot1/workspace:/workspace:rw
    environment:
      # ========================================
      # API設定（どちらか一方を有効にしてください）
      # ========================================

      # Anthropic (公式Claudeモデル) を使用する場合
      # - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}

      # Z.AI (GLMモデル) を使用する場合
      - ANTHROPIC_API_KEY=${ZAI_API_KEY}
      - ANTHROPIC_BASE_URL=https://api.z.ai/api/anthropic

      # GLMモデル設定 (Z.AIを使用する場合のみ有効)
      - ANTHROPIC_DEFAULT_HAIKU_MODEL=glm-4.5-air
      - ANTHROPIC_DEFAULT_SONNET_MODEL=glm-4.7
      - ANTHROPIC_DEFAULT_OPUS_MODEL=glm-4.7

      # Claude Code オプション
      # --dangerously-skip-permissions を有効にするかどうか
      - CLAUDE_SKIP_PERMISSIONS=${CLAUDE_SKIP_PERMISSIONS}
    networks:
      - cinderella-network

  # Browser API
  browser-api:
    build:
      context: ./browser-api
    ports:
      - "8083:8000"    # API
      - "5900:5900"    # VNC
      - "7900:7900"    # noVNC
    volumes:
      - ./data/screenshots:/app/screenshots
      - ./data/chrome-profile:/app/chrome-profile
    environment:
      - ALLOWED_ORIGINS=*
    networks:
      - cinderella-network
    restart: unless-stopped

  # Discord Bot
  discord-bot:
    build:
      context: ./discord-bot
      dockerfile: Dockerfile
    ports:
      - "8082:8080"  # Discord Bot API

    environment:
      - DISCORD_TOKEN=${DISCORD_TOKEN}
      - CINDERELLA_URL=http://cc-api:8080
      - API_PORT=8080
    depends_on:
      - cc-api
    networks:
      - cinderella-network
    restart: unless-stopped

networks:
  cinderella-network:
    name: cinderella-network
    driver: bridge
